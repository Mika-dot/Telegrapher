<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Поиск</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/md5.js"></script>

<body>

    <form name="userForm" class="card p-2" style="margin: 10% 10%;">
        <div class="input-group">
            <select onchange="Read()" class="form-select" name="Reque" required="">
                <option>Everybody</option>
                <option>Author</option>
                <option>Name</option>
                <option>ID</option>
            </select>
            <input onchange="Read()" type="text" class="form-control" name="Search" placeholder="Искомое значение">
        </div>
    </form>

    <div id="cardsList">

    </div>
</body>

<script src='https://dl.dropboxusercontent.com/s/hb9vf8r4vz7imyy/ckeditor.js'></script>
<script>

    // myEditor.setData(text); // ввод текста в content
    // myEditor.getData(); // вывод значений

    function Read() {

        console.log("+");

        document.getElementById('cardsList').innerHTML = '';

        if (document.forms["userForm"].elements["Reque"].value == "Everybody") {
            GetUsers();
        } else {
            SearchValues();
        }

        //GetUsers();
        //     console.log("/api/Requests/Request=" + Request + "&Search=" + document.forms["userForm"].elements["Search"].value);


    }

    async function SearchValues() {

        const response = await fetch("/api/Request/Request=" + document.forms["userForm"].elements["Reque"].value + "&Search=" + document.forms["userForm"].elements["Search"].value, {
            method: "GET",
            headers: { "Accept": "application/json" }
        });
        // если запрос прошел нормально
        if (response.ok === true) {
            // получаем данные
            const data = await response.json();

            console.log(data.data[0]);

            for (let i = 0; i < data.data.length; i++) {
                row(data.data[i]);
            }

        }
    }
    // Получение всех пользователей
    async function GetUsers() {
        // отправляет запрос и получаем ответ
        const response = await fetch("/api/Requests", {
            method: "GET",
            headers: { "Accept": "application/json" }
        });
        // если запрос прошел нормально
        if (response.ok === true) {
            // получаем данные
            const data = await response.json();
            //console.log(data.data);
            console.log(data.data[0].id); // робит

            document.getElementById('cardsList').innerHTML = '';

            for (let i = 0; i < data.data.length; i++) {
                row(data.data[i]);
            }
        }
    }


    // создание строки для таблицы
    function row(user) {

        document.getElementById('cardsList').insertAdjacentHTML('beforeend',
            `
            <div fid="cardsList" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" style="margin:  5% 20%;">
                <form name="userForm">
                    <div class="m-auto" style="max-width: 500px;">
                        <div style="margin-top: 5%; margin-bottom: 5%; display: flex;">
                            <button style="margin-right: 10%;" type="button" class="btn btn-light"
                                onclick="ref(` + user.id + `)">Читать</button>
                            <div>
                                <label style="margin: 5%; font-size: 150%;" class="p-2" name="name">` + user.name + `</label>
                                <label style="margin: 5%; ; color: #808080;" class="p-2" name="author">` + user.author + `</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

        `
        );

        return 0;
    }

    function ref(id) {
        window.location.href = '/pages/' + id;
    }


</script>


</html>